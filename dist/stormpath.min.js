/*
 Stormpath.js v0.3.1
 (c) 2014 Stormpath, Inc. http://stormpath.com
 License: Apache 2.0
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Stormpath=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b){var c="object"==typeof a?a:{},d="function"==typeof a?a:b||f.noop,h=this;if(h.jwt=c.token||h._getToken(),!h.jwt)return void setTimeout(function(){d(new Error("jwt not found as url query parameter"))},1);try{h.jwtPayload=JSON.parse(g.atob(h.jwt.split(".")[1])),h.appHref=h.jwtPayload.app_href,h.sptoken=h.jwtPayload.sp_token||null,h.baseurl=h.appHref.match("^.+//([^/]+)/")[0]}catch(i){return void setTimeout(function(){d(i)},1)}h.jwtPayload.onk&&h.setCachedOrganizationNameKey(h.jwtPayload.onk);var j=h.appHref;h.requestExecutor=c.requestExecutor||new e(h.jwt),h.requestExecutor.execute("GET",j+"?expand=idSiteModel",function(a,b){d(a,a?null:b.idSiteModel)})}var e=a("./request-executor"),f=a("./utils"),g=f.base64;d.prototype.organizationNameKeyCookieKey="sp.onk",d.prototype.organizationNameKeyCookieExpiration="expires=Fri, 31 Dec 9999 23:59:59 GMT",d.prototype.getCachedOrganizationNameKey=function(){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(this.organizationNameKeyCookieKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},d.prototype.setCachedOrganizationNameKey=function(a){document.cookie=encodeURIComponent(this.organizationNameKeyCookieKey)+"="+encodeURIComponent(a)+"; "+this.organizationNameKeyCookieExpiration},d.prototype._getToken=function(){return decodeURIComponent((window.location.href.match(/jwt=(.+)/)||[])[1]||"")},d.prototype.login=function(a,b){var c,d=this,e="object"==typeof a?a:null;if(!e)throw new Error("must provide an object");if(e.providerData)c=e;else{if(!e.login)throw new Error("unsupported credentials object");c={type:"basic",value:f.base64.btoa(e.login+":"+e.password)}}e.accountStore&&(c.accountStore=e.accountStore),d.requestExecutor.execute("POST",d.appHref+"/loginAttempts",{body:c,withCredentials:!0},b||f.noop)},d.prototype.register=function(a,b){if("object"!=typeof a)throw new Error("client.register() must be called with a data object");var c=this;c.requestExecutor.execute("POST",c.appHref+"/accounts",{body:a,withCredentials:!0},b||f.noop)},d.prototype.verifyEmailToken=function(a){if("function"!=typeof a)throw new Error("client.verifyEmailToken() takes a function as it's only argument");var b=this;b.requestExecutor.execute("POST",b.baseurl+"/v1/accounts/emailVerificationTokens/"+b.sptoken,a)},d.prototype.verifyPasswordResetToken=function(a){if("function"!=typeof a)throw new Error("client.verifyPasswordResetToken() takes a function as it's only argument");var b=this;b.requestExecutor.execute("GET",b.appHref+"/passwordResetTokens/"+b.sptoken,a)},d.prototype.setAccountPassword=function(a,b,c){if(!a||!a.href)throw new Error("invalid pwTokenVerification");if(!b)throw new Error("must supply new password as second argument to client.setAccountPassword()");var d=this;d.requestExecutor.execute("POST",a.href,{body:{password:b}},c||f.noop)},d.prototype.sendPasswordResetEmail=function(a,b){var c;if("string"==typeof a)c={email:a};else{if("object"!=typeof a)throw new Error("sendPasswordResetEmail must be called with an email/username as the first argument, or an options object");c=a}var d=this;d.requestExecutor.execute("POST",d.appHref+"/passwordResetTokens",{body:c},b||f.noop)},b.exports=d},{"./request-executor":3,"./utils":4}],2:[function(a,b,c){b.exports={Client:a("./client")}},{"./client":1}],3:[function(a,b,c){"use strict";function d(a,b,c,d){var e=this;return e.cb=d,e.options=c,e.xhr=new XMLHttpRequest,e.xhr.onreadystatechange=e.onLoad.bind(e),e.xhr.onerror=e.onerror.bind(e),e.xhr.open(a,b),c.withCredentials&&(e.xhr.withCredentials=c.withCredentials),e.xhr.setRequestHeader("Authorization","Bearer "+e.options.authToken),e.xhr.setRequestHeader("Content-Type","application/json"),e.xhr.send(JSON.stringify(c.body)),e.done=!1,e}function e(a){this.authToken=a,this.terminated=!1}var f=a("./utils");d.prototype.onLoad=function(){var a=this,b=XMLHttpRequest,c=a.xhr.readyState;if(c===b.DONE&&!a.done)try{var d=a.responseHeaders=a.getHeadersObject(),e="string"==typeof a.xhr.responseText&&""!==a.xhr.responseText?JSON.parse(a.xhr.responseText):{},f=a.xhr.status,g=((d.Authorization||"").match(/Bearer (.*)$/i)||[])[1]||"";a.cb(400>f?null:e,g,a,400>f?e:null),a.done=!0}catch(h){a.cb(h)}},d.prototype.onerror=function(){var a=this;a.done=!0,a.cb(new Error("Unknown XHR Error"))},d.prototype.getHeadersObject=function(){var a=this,b=a.xhr.getAllResponseHeaders().trim().split("\n");return b.reduce(function(a,b){var c=b.split(": ");return a[c[0]]=c[1].trim(),a},{})},e.prototype.execute=function(a,b,c,e){var g=this;if(g.terminated)return e(new Error("Request executor terminated, you must initiate a new flow from the service provider"));var h="object"==typeof c?c:{body:null};h.authToken=g.authToken;var i="function"==typeof c?c:e||f.noop,j=new d(a,b,h,function(a,b,c,d){var e=c&&c.responseHeaders&&c.responseHeaders["Stormpath-SSO-Redirect-Location"];return g.authToken=b,a||g.authToken||(g.terminated=!0),a?(e&&(a.redirectUrl=e),i(a)):(e&&(d.redirectUrl=e),void i(a,d))});return j},b.exports=e},{"./utils":4}],4:[function(a,b,c){"use strict";function d(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)}))}b.exports={base64:{atob:function(a){return decodeURIComponent(window.atob(a))},btoa:function(a){var b=d(a);return b}},noop:function(){}}},{}]},{},[2])(2)});