/*
 Stormpath.js v0.4.0
 (c) 2014-2015 Stormpath, Inc. http://stormpath.com
 License: Apache 2.0
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Stormpath=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b){var c="object"==typeof a?a:{},d="function"==typeof a?a:b||h.noop,j=this,k=null;if(j.jwt=c.token||j.getJwtFromUrl(),!j.jwt)return e(d,[new Error(g.errors.JWT_NOT_FOUND)]);if(k=j.jwt.split("."),k.length<2||k.length>3)return e(d,[new Error(g.errors.NOT_A_JWT)]);try{j.jwtPayload=JSON.parse(i.atob(k[1]))}catch(l){return e(d,[new Error(g.errors.MALFORMED_JWT_CLAIMS)])}j.appHref=j.jwtPayload.app_href,j.sptoken=j.jwtPayload.sp_token||null,j.baseurl=j.appHref.match("^.+//([^/]+)/")[0],j.jwtPayload.onk&&j.setCachedOrganizationNameKey(j.jwtPayload.onk);var m=j.appHref;j.requestExecutor=c.requestExecutor||new f(j.jwt),j.requestExecutor.execute({method:"GET",url:m+"?expand=idSiteModel",json:!0},function(a,b){return a?d(401===a.status?new Error(g.errors.INITIAL_JWT_REJECTED):a):j.requestExecutor.authToken?void d(null,b.idSiteModel):d(new Error(g.errors.NO_AUTH_TOKEN_HEADER))})}var e=a("./defer-callback"),f=a("./idsite-request-executor"),g=a("./strings"),h=a("./utils"),i=h.base64;d.prototype.organizationNameKeyCookieKey="sp.onk",d.prototype.organizationNameKeyCookieExpiration="expires=Fri, 31 Dec 9999 23:59:59 GMT",d.prototype.getCachedOrganizationNameKey=function(){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(this.organizationNameKeyCookieKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},d.prototype.setCachedOrganizationNameKey=function(a){document.cookie=encodeURIComponent(this.organizationNameKeyCookieKey)+"="+encodeURIComponent(a)+"; "+this.organizationNameKeyCookieExpiration},d.prototype.getJwtFromUrl=function(){return decodeURIComponent((window.location.href.match(/jwt=([^&]+)/)||[])[1]||"")},d.prototype.login=function(a,b){var c,d=this,e="object"==typeof a?a:null;if(!e)throw new Error("must provide an object");if(e.providerData)c=e;else{if(!e.login)throw new Error("unsupported credentials object");c={type:"basic",value:h.base64.btoa(e.login+":"+e.password)}}e.accountStore&&(c.accountStore=e.accountStore),d.requestExecutor.execute({method:"POST",url:d.appHref+"/loginAttempts",json:c},b||h.noop)},d.prototype.register=function(a,b){if("object"!=typeof a)throw new Error("client.register() must be called with a data object");var c=this;c.requestExecutor.execute({method:"POST",url:c.appHref+"/accounts",json:a},b||h.noop)},d.prototype.verifyEmailToken=function(a){var b=this;if("function"!=typeof a)throw new Error("client.verifyEmailToken() takes a function as it's only argument");b.requestExecutor.execute({method:"POST",url:b.baseurl+"/v1/accounts/emailVerificationTokens/"+b.sptoken},a)},d.prototype.verifyPasswordResetToken=function(a){var b=this;if("function"!=typeof a)throw new Error("client.verifyPasswordResetToken() takes a function as it's only argument");b.requestExecutor.execute({method:"GET",url:b.appHref+"/passwordResetTokens/"+b.sptoken,json:!0},a)},d.prototype.setAccountPassword=function(a,b,c){var d=this;if(!a||!a.href)throw new Error("invalid passwordVerificationTokenResource");if(!b)throw new Error("must supply new password as second argument to client.setAccountPassword()");d.requestExecutor.execute({method:"POST",url:a.href,json:{password:b}},c||h.noop)},d.prototype.sendPasswordResetEmail=function(a,b){var c,d=this;if("string"==typeof a)c={email:a};else{if("object"!=typeof a)throw new Error("sendPasswordResetEmail must be called with an email/username as the first argument, or an options object");c=a}d.requestExecutor.execute({method:"POST",url:d.appHref+"/passwordResetTokens",json:c},b||h.noop)},b.exports=d},{"./defer-callback":2,"./idsite-request-executor":3,"./strings":5,"./utils":6}],2:[function(a,b,c){"use strict";function d(a,b){setTimeout(function(){a.apply(null,b)},0)}b.exports=d},{}],3:[function(a,b,c){"use strict";function d(a){this.authToken=a}var e=a("xhr"),f=a("./strings.json");d.prototype.handleResponse=function(a,b,c,d){var e=this,g=b.headers.authorization,h=null,i=b.headers["stormpath-sso-redirect-location"];if(g){if(h=g.split("Bearer"),2!==h.length)return d(new Error(f.errors.INVALID_AUTH_TOKEN_HEADER));e.authToken=h[1].trim()}else e.authToken=null;return a?d(a):b.statusCode>399?(i&&(c.serviceProviderCallbackUrl=i),d(c)):i?d(null,{serviceProviderCallbackUrl:i}):void d(null,c)},d.prototype.execute=function(a,b){var c=this;if("object"!=typeof a)throw new Error("Must provide xhrRequestOptions as first parameter");if("function"!=typeof b)throw new Error("Must provide callback as second parameter");return a.headers||(a.headers={}),c.authToken?(a.headers.Authorization="Bearer "+c.authToken,e(a,function(a,d,e){c.handleResponse(a,d,e,b)})):b(new Error(f.errors.NO_AUTH_TOKEN))},b.exports=d},{"./strings.json":5,xhr:7}],4:[function(a,b,c){b.exports={Client:a("./client")}},{"./client":1}],5:[function(a,b,c){b.exports={errors:{JWT_NOT_FOUND:"JWT not found as url query parameter.",NOT_A_JWT:"JWT does not appear to be a property formatted JWT.",MALFORMED_JWT_CLAIMS:"The JWT claims section is malfomed and could not be decoded as JSON.",NO_AUTH_TOKEN_HEADER:"HTTP response does not contain Authorization header.",INVALID_AUTH_TOKEN_HEADER:"HTTP response has an invalid Authorization header.",INITIAL_JWT_REJECTED:"The JWT used to initialized the client was rejected."}}},{}],6:[function(a,b,c){"use strict";function d(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)}))}b.exports={base64:{atob:function(a){return decodeURIComponent(window.atob(a))},btoa:function(a){var b=d(a);return b}},noop:function(){}}},{}],7:[function(a,b,c){"use strict";function d(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function e(a,b){function c(){4===l.readyState&&j()}function f(){var a=void 0;if(l.response?a=l.response:"text"!==l.responseType&&l.responseType||(a=l.responseText||l.responseXML),u)try{a=JSON.parse(a)}catch(b){}return a}function g(a){clearTimeout(o),a instanceof Error||(a=new Error(""+(a||"Unknown XMLHttpRequest Error"))),a.statusCode=0,b(a,k)}function j(){if(!n){var c;clearTimeout(o),c=a.useXDR&&void 0===l.status?200:1223===l.status?204:l.status;var d=k,e=null;0!==c?(d={body:f(),statusCode:c,method:q,headers:{},url:p,rawRequest:l},l.getAllResponseHeaders&&(d.headers=i(l.getAllResponseHeaders()))):e=new Error("Internal XMLHttpRequest Error"),b(e,d,d.body)}}var k={body:void 0,headers:{},statusCode:0,method:q,url:p,rawRequest:l};if("string"==typeof a&&(a={uri:a}),a=a||{},"undefined"==typeof b)throw new Error("callback argument missing");b=h(b);var l=a.xhr||null;l||(l=a.cors||a.useXDR?new e.XDomainRequest:new e.XMLHttpRequest);var m,n,o,p=l.url=a.uri||a.url,q=l.method=a.method||"GET",r=a.body||a.data,s=l.headers=a.headers||{},t=!!a.sync,u=!1;if("json"in a&&(u=!0,s.accept||s.Accept||(s.Accept="application/json"),"GET"!==q&&"HEAD"!==q&&(s["content-type"]||s["Content-Type"]||(s["Content-Type"]="application/json"),r=JSON.stringify(a.json))),l.onreadystatechange=c,l.onload=j,l.onerror=g,l.onprogress=function(){},l.ontimeout=g,l.open(q,p,!t,a.username,a.password),t||(l.withCredentials=!!a.withCredentials),!t&&a.timeout>0&&(o=setTimeout(function(){n=!0,l.abort("timeout");var a=new Error("XMLHttpRequest timeout");a.code="ETIMEDOUT",g(a)},a.timeout)),l.setRequestHeader)for(m in s)s.hasOwnProperty(m)&&l.setRequestHeader(m,s[m]);else if(a.headers&&!d(a.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in a&&(l.responseType=a.responseType),"beforeSend"in a&&"function"==typeof a.beforeSend&&a.beforeSend(l),l.send(r),l}function f(){}var g=a("global/window"),h=a("once"),i=a("parse-headers");b.exports=e,e.XMLHttpRequest=g.XMLHttpRequest||f,e.XDomainRequest="withCredentials"in new e.XMLHttpRequest?e.XMLHttpRequest:g.XDomainRequest},{"global/window":8,once:9,"parse-headers":13}],8:[function(a,b,c){(function(a){"undefined"!=typeof window?b.exports=window:"undefined"!=typeof a?b.exports=a:"undefined"!=typeof self?b.exports=self:b.exports={}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(a,b,c){function d(a){var b=!1;return function(){return b?void 0:(b=!0,a.apply(this,arguments))}}b.exports=d,d.proto=d(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return d(this)},configurable:!0})})},{}],10:[function(a,b,c){function d(a,b,c){if(!h(b))throw new TypeError("iterator must be a function");arguments.length<3&&(c=this),"[object Array]"===i.call(a)?e(a,b,c):"string"==typeof a?f(a,b,c):g(a,b,c)}function e(a,b,c){for(var d=0,e=a.length;e>d;d++)j.call(a,d)&&b.call(c,a[d],d,a)}function f(a,b,c){for(var d=0,e=a.length;e>d;d++)b.call(c,a.charAt(d),d,a)}function g(a,b,c){for(var d in a)j.call(a,d)&&b.call(c,a[d],d,a)}var h=a("is-function");b.exports=d;var i=Object.prototype.toString,j=Object.prototype.hasOwnProperty},{"is-function":11}],11:[function(a,b,c){function d(a){var b=e.call(a);return"[object Function]"===b||"function"==typeof a&&"[object RegExp]"!==b||"undefined"!=typeof window&&(a===window.setTimeout||a===window.alert||a===window.confirm||a===window.prompt)}b.exports=d;var e=Object.prototype.toString},{}],12:[function(a,b,c){function d(a){return a.replace(/^\s*|\s*$/g,"")}c=b.exports=d,c.left=function(a){return a.replace(/^\s*/,"")},c.right=function(a){return a.replace(/\s*$/,"")}},{}],13:[function(a,b,c){var d=a("trim"),e=a("for-each"),f=function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.exports=function(a){if(!a)return{};var b={};return e(d(a).split("\n"),function(a){var c=a.indexOf(":"),e=d(a.slice(0,c)).toLowerCase(),g=d(a.slice(c+1));"undefined"==typeof b[e]?b[e]=g:f(b[e])?b[e].push(g):b[e]=[b[e],g]}),b}},{"for-each":10,trim:12}]},{},[4])(4)});